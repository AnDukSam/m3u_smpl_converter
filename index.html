<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U â‡Œ SMPL í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë³€í™˜ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .conversion-area {
            display: flex;
            gap: 20px;
        }
        .input-group, .output-group {
            flex: 1;
        }
        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: Consolas, monospace;
            font-size: 14px;
            background-color: #f9f9f9;
            /* smplOutputì—ì„œ readonlyê°€ ì œê±°ë˜ì–´ ì´ì œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤. */
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        button {
            padding: 12px 25px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        #convertM3U {
            background-color: #007bff;
            color: white;
        }
        #convertSMPL {
            background-color: #28a745;
            color: white;
        }
        /* ë‚´ìš© ë¹„ìš°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        #clearContent {
            background-color: hotpink; /* í•‘í¬ìƒ‰ */
            color: white;
        }
        button:hover {
            opacity: 0.9;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .info-box {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ffc107;
            background-color: #fff3cd;
            color: #856404;
            border-radius: 4px;
            /* ìš”ì²­ëœ ìˆ˜ì • ì‚¬í•­: í•˜ë‹¨ ë°”ê¹¥ ì—¬ë°± ì¶”ê°€ */
            margin-bottom: 20px; 
        }
        /* ìƒíƒœ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #statusMessage {
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¶ M3U â‡Œ SMPL í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë³€í™˜ê¸°</h1>
    <div class="info-box">
        âš ï¸ ì£¼ì˜ ì‚¬í•­<br>
        - M3U â†’ SMPL ë³€í™˜ ì‹œ: SMPL íŒŒì¼ ê²½ë¡œ ì•ì— '/storage/emulated/0/Music/'ë¥¼ ì¶”ê°€í•˜ê³ , '\'ë¥¼ '/'ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.<br>
        - SMPL â†’ M3U ë³€í™˜ ì‹œ: SMPL ê²½ë¡œì—ì„œ '/storage/emulated/0/Music/'ë¥¼ ì œê±°í•˜ê³ , '/'ë¥¼ '\'ë¡œ ë³€ê²½í•˜ë©°, ì¬ìƒ ì‹œê°„ì€ '0'ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
    </div>
    
    <div class="conversion-area">
        <div class="input-group">
            <label for="m3uInput">M3U ì…ë ¥ ì˜ì—­</label>
            <textarea id="m3uInput" placeholder="ì—¬ê¸°ì— M3U íŒŒì¼ ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (ì˜ˆ: #EXTINF:..., íŒŒì¼ ê²½ë¡œ...)"></textarea>
        </div>
        <div class="output-group">
            <label for="smplOutput">SMPL (JSON) ì¶œë ¥ ì˜ì—­</label>
            <textarea id="smplOutput" placeholder="ë³€í™˜ëœ SMPL JSON í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
        </div>
    </div>

    <div class="controls">
        <button id="convertM3U">M3U â†’ SMPL ë³€í™˜</button>
        <button id="convertSMPL">SMPL â†’ M3U ë³€í™˜(ì—­ë³€í™˜)</button>
        <button id="clearContent">ë‚´ìš© ë¹„ìš°ê¸°</button>
        <div id="statusMessage"></div> 
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const m3uInput = document.getElementById('m3uInput');
    const smplOutput = document.getElementById('smplOutput');
    const convertM3UButton = document.getElementById('convertM3U');
    const convertSMPLButton = document.getElementById('convertSMPL');
    const clearContentButton = document.getElementById('clearContent'); // ìƒˆë¡œìš´ ë²„íŠ¼ DOM ìš”ì†Œ
    const statusMessage = document.getElementById('statusMessage');

    /**
     * ìƒíƒœ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
     * @param {string} color - ë©”ì‹œì§€ ìƒ‰ìƒ (ì„ íƒ ì‚¬í•­)
     */
    function showStatus(message, color = '#007bff') {
        statusMessage.textContent = message;
        statusMessage.style.color = color;
        // 5ì´ˆ í›„ì— ë©”ì‹œì§€ ì´ˆê¸°í™”
        setTimeout(() => {
            statusMessage.textContent = '';
        }, 5000);
    }

    // ------------------------------------------------------------------
    // 1. M3U to SMPL Conversion Logic
    // ------------------------------------------------------------------
    function convertM3UtoSMPL() {
        const m3uText = m3uInput.value;
        if (!m3uText.trim()) {
            showStatus('M3U ì…ë ¥ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.', 'red');
            return;
        }

        const playlistName = "Converted Playlist"; 
        const lines = m3uText.split(/\r?\n/).filter(line => line.trim() !== '' && line.toUpperCase() !== '#EXTM3U');
        
        const members = [];
        let order = 0;

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();

            if (line.startsWith('#EXTINF')) {
                const titleArtistMatch = line.match(/#EXTINF:\d+,(.*) - (.*)/);
                let title = '';
                let artist = '';
                
                if (titleArtistMatch) {
                    title = titleArtistMatch[1].trim();
                    artist = titleArtistMatch[2].trim();
                } else {
                    const titleOnlyMatch = line.match(/#EXTINF:\d+,(.*)/);
                    if (titleOnlyMatch) {
                        title = titleOnlyMatch[1].trim();
                        const lastHyphenIndex = title.lastIndexOf(' - ');
                        if (lastHyphenIndex !== -1) {
                            artist = title.substring(lastHyphenIndex + 3).trim();
                            title = title.substring(0, lastHyphenIndex).trim();
                        } else {
                            artist = "Unknown Artist";
                        }
                    }
                }

                if (title && i + 1 < lines.length) {
                    const relativePath = lines[i + 1].trim();
                    i++; 

                    const pathPrefix = '/storage/emulated/0/Music/';
                    const smplPath = pathPrefix + relativePath.replace(/\\/g, '/');

                    members.push({
                        artist: artist,
                        info: smplPath,
                        order: order++,
                        title: title,
                        type: 65537
                    });
                }
            }
        }

        const smplObject = {
            members: members,
            name: playlistName,
            recentlyPlayedDate: 0,
            sortBy: 4,
            version: 1
        };

        smplOutput.value = JSON.stringify(smplObject, null, 4);
        showStatus('M3U â†’ SMPL ë³€í™˜ì´ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.', 'green'); 
    }

    // ------------------------------------------------------------------
    // 2. SMPL to M3U Conversion Logic (Inverse)
    // ------------------------------------------------------------------
    function convertSMPLtoM3U() {
        // smplOutputì—ì„œ ë°”ë¡œ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ m3uInputì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        let smplText = smplOutput.value || m3uInput.value; 
        let smplObject;
        
        if (!smplText.trim()) {
            showStatus('SMPL ì…ë ¥ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. SMPL í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë¨¼ì € M3Uë¥¼ ë³€í™˜í•˜ì„¸ìš”.', 'red');
            return;
        }

        try {
            smplObject = JSON.parse(smplText);
        } catch (e) {
            showStatus('ìœ íš¨í•˜ì§€ ì•Šì€ SMPL JSON í˜•ì‹ì…ë‹ˆë‹¤.', 'red');
            return;
        }

        if (!smplObject.members || !Array.isArray(smplObject.members)) {
            showStatus('SMPL JSONì— "members" ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤.', 'red');
            return;
        }

        smplObject.members.sort((a, b) => (a.order > b.order) ? 1 : -1);

        let m3uOutputText = '#EXTM3U\n';
        const pathPrefix = '/storage/emulated/0/Music/';

        smplObject.members.forEach(member => {
            const title = member.title || 'Unknown Title';
            const artist = member.artist || 'Unknown Artist';
            m3uOutputText += `#EXTINF:0,${title} - ${artist}\n`;

            let relativePath = member.info || '';
            if (relativePath.startsWith(pathPrefix)) {
                relativePath = relativePath.substring(pathPrefix.length);
            }
            relativePath = relativePath.replace(/\//g, '\\');
            
            m3uOutputText += `${relativePath}\n`;
        });

        m3uInput.value = m3uOutputText;
        showStatus('SMPL â†’ M3U ë³€í™˜(ì—­ë³€í™˜)ì´ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.', 'green'); 
    }

    // ------------------------------------------------------------------
    // 3. Clear Content Logic
    // ------------------------------------------------------------------
    function clearContents() {
        m3uInput.value = '';
        smplOutput.value = '';
        showStatus('ì…ë ¥/ì¶œë ¥ ë‚´ìš©ì´ ëª¨ë‘ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'hotpink');
    }


    // Event Listeners
    convertM3UButton.addEventListener('click', convertM3UtoSMPL);
    convertSMPLButton.addEventListener('click', convertSMPLtoM3U);
    clearContentButton.addEventListener('click', clearContents); // 'ë‚´ìš© ë¹„ìš°ê¸°' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
});
</script>
</body>
</html>
